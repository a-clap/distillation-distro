From cde2d1182df0a0e8c450db7c86054e5a69f8b6aa Mon Sep 17 00:00:00 2001
From: OpenEmbedded <oe.patch@oe>
Date: Sun, 9 Oct 2022 07:08:23 +0200
Subject: [PATCH] spidev dt compatibility

---
 arch/arm/boot/dts/sun7i-a20-bananapi.dts | 16 +++++++++++++---
 drivers/spi/spidev.c                     |  2 ++
 2 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/sun7i-a20-bananapi.dts b/arch/arm/boot/dts/sun7i-a20-bananapi.dts
index 02b5ca45c9f0..5fad31a2bdca 100644
--- a/arch/arm/boot/dts/sun7i-a20-bananapi.dts
+++ b/arch/arm/boot/dts/sun7i-a20-bananapi.dts
@@ -299,10 +299,20 @@ &reg_usb2_vbus {
 
 &spi0 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&spi0_pi_pins>,
-		    <&spi0_cs0_pi_pin>,
-		    <&spi0_cs1_pi_pin>;
+	pinctrl-0 = <&spi0_pi_pins>, <&spi0_cs0_pi_pin>, <&spi0_cs1_pi_pin>;
 	status = "okay";
+
+	spidev@0 {
+		compatible = "rohm,dh2228fv";
+		reg = <0>;
+		spi-max-frequency = <32000000>;
+	};
+
+	spidev@1 {
+		compatible = "rohm,dh2228fv";
+		reg = <1>;
+		spi-max-frequency = <32000000>;
+	};
 };
 
 &uart0 {
diff --git a/drivers/spi/spidev.c b/drivers/spi/spidev.c
index b2775d82d2d7..70f7f4a0e6cb 100644
--- a/drivers/spi/spidev.c
+++ b/drivers/spi/spidev.c
@@ -691,6 +691,7 @@ static const struct spi_device_id spidev_spi_ids[] = {
 	{ .name = "m53cpld" },
 	{ .name = "spi-petra" },
 	{ .name = "spi-authenta" },
+	{ .name = "max31865" },
 	{},
 };
 MODULE_DEVICE_TABLE(spi, spidev_spi_ids);
@@ -717,6 +718,7 @@ static const struct of_device_id spidev_dt_ids[] = {
 	{ .compatible = "menlo,m53cpld", .data = &spidev_of_check },
 	{ .compatible = "cisco,spi-petra", .data = &spidev_of_check },
 	{ .compatible = "micron,spi-authenta", .data = &spidev_of_check },
+	{ .compatible = "max,max31865", .data = &spidev_of_check },
 	{},
 };
 MODULE_DEVICE_TABLE(of, spidev_dt_ids);
-- 
2.34.1

